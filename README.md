# backend-test-task-fastapi
Решение тестового задания для компании ITWorld. 

Автор: Михалев Лев Сергеевич

Цель: Разработать лёгкий backend-сервис блога с поддержкой админских операций, публичного API и безопасной работы с пользовательскими данными.

Результат: Создан легки backend-сервис блога с поддержкой админский операций (CRUD для постов и категорий, а так же управление ролями пользователей) и безопасной работы с пользовательскими данными. В частности добавлена фича rate limits на 60 запросов в минуту.

# Стек
* Python 3.13
* uv (package manager)
* Фреймворк: FastAPI + Uvicorn
* БД: PostgreSQL
* ORM: SQLAlchemy 2.0.46
* Миграции: Alembic
* Redis
* Валидация: Pydantic v2
* Аутентификация: JWT (access/refresh), пароли — bcrypt
* Санитизация HTML: bleach
* Контейнеризация: Docker / docker-compose
* Тесты: pytest + httpx



# Запуск проекта
## 1. Подготовка
Скопируйте файл окружения с реальными значениями (или оставьте значения по-умолчанию):

```bash
  cp .env.example .env
```
## 2. Запуск через Docker
```bash
docker compose up --build
```
После запуска автоматически запуститься база данных PostgreSQl, применятся миграции, запускается FastAPI, а так же запускаются
дополнительные служба: Redis, Adminer.

# Миграции

## Автоматически
При запуске контейнера миграции применяются автоматически через entrypoint.

## Вручную
```bash
  docker compose exec backend bash
  alembic upgrade head 
```


## Создание новой миграции

```bash
  docker compose exec backend bash
  alembic revision --autogenerate -m "Add {name_model} model"
  alembic upgrade head 
  exit
```
Скопировать миграции из контейнера себе в проект
```bash
  docker compose cp backend:/app/app/alembic ./app
```

# Доступные ссылки
## Документация API
После запуска доступны следующие ссылки:
- Swagger: http://127.0.0.1:8000/docs
- ReDoc: http://127.0.0.1:8000/redoc

### Логин и пароль суперюзера по умолчанию:
Логин:
  ```
  admim@example.com
  ```
Пароль:
  ```
  changethis
  ```
## Adminer
Веб-интерфйес для работы с БД доступен по ссылке: http://127.0.0.1:8080
 
### Данные авторизации для подключения к базе по-умолчанию
  ```
  POSTGRES_DB=app
  POSTGRES_USER=postgres
  POSTGRES_PASSWORD=changethis
  ```

# Структура проекта
```
app/
├── api/      # Роуты и зависимости
├── core/     # Конфигурация, безопасность, константы
├── db/       # База данных и CRUD
├── models/   # SQLAlchemy модели
├── schemas/  # Pydantic-схемы
├── services/ # Бизнес-логика
├── alembic/  # Миграции
└── main.py   # Точка входа
```


# Модели данных

### User

| Поле            | Тип  | Описание           |
|-----------------|------|--------------------|
| id              | UUID | Идентификатор      |
| email           | str  | Email пользователя |
| full_name       | str  | Имя пользователя   |
| hashed_password | str  | Хэш пароля         |
| role            | enum | Роль пользователя  |
| is_active       | bool | Активность         |
| date_created    | bool | Дата создания      |
| date_updated    | bool | Дата обновления    |

---

### Post

| Поле         | Тип  | Описание          |
|--------------|------|-------------------|
| id           | UUID | Идентификатор     |
| title        | str  | Заголовок         |
| content_html | text | Контент           |
| category_id  | UUID | Категория         |
| slug         | str  | URL-идентификатор |
| date_created | bool | Дата создания     |
| date_updated | bool | Дата обновления   |

---

### Category

| Пол е        | Тип  | Описание          |
|--------------|------|-------------------|
| id           | UUID | Идентификатор     |
| name         | str  | Название          |
| slug         | str  | URL-идентификатор |
| date_created | bool | Дата создания     |
| date_updated | bool | Дата обновления   |

---


# Возможности и улучшения
- [ ] Добавить обновление slug при изменении
- [ ] Реализовать хранение refresh-токенов в куки
- [ ] Добавить почтовую почту и верификацию почту
- [ ] Добавить возможность пользователям ставить лайки
- [ ] Добавить возможность отслеживать количество просмотров
- [ ] Кеширование через Redis
- [x] Rate limits через Redis
- [ ] Мониторинг системы (например, Prometheus)
